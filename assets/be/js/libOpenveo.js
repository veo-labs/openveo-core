"use strict";!function(){function t(n){var e,o="/be/";return e=openVeoSettings.user,{login:function(t,e){return n.post(o+"authenticate",{login:t,password:e})},logout:function(){return n.post(o+"logout")},getUserInfo:function(){return e},setUserInfo:function(t){e=t||null}}}angular.module("ov.authentication",[]).factory("authenticationService",t),t.$inject=["$http"]}(),angular.module("ov.storage",[]).provider("storage",function(){var o=this;this.prefix="ov-",this.type="localStorage",this.$get=["$window",function(n){function t(t,e){n[o.type][o.prefix+t]=e}return{get:function(t){return n[o.type][o.prefix+t]},add:t,set:t,remove:function(t){n[o.type].removeItem(o.prefix+t)}}}]}),function(a){var t=a.module("ov.i18n",["ngCookies"]);function e(n,e){var t,i=e.get("language")||navigator.language||navigator.browserLanguage,r={},o=[];function a(t){for(var e=0;e<o.length;e++)if(t===o[e].value)return!0;return!1}function l(){for(var t=0;t<o.length;t++)o[t].active=o[t].value===i}function c(t){a(t)&&(i=t,e.put("language",i),l())}function u(t,e){if(t&&e){for(var n=t.split("."),o=e,i=0;i<n.length;i++)o[n[i]]&&(o=o[n[i]]);return"string"==typeof o?o:t}return t}return o=[{value:"en",label:"CORE.LANGUAGE.ENGLISH"},{value:"fr",label:"CORE.LANGUAGE.FRENCH"}],a(i)?l():a(t=i.split("-")[0])?c(t):c(o[0].value),{addDictionary:function(e,t){if(e&&(!r[e]||void 0===r[e][i])){t=(t=t||!1)?"/be/":"/";return t+="getDictionary/"+e+"/"+i,n.get(t).then(function(t){r[e]||(r[e]={}),r[e][i]=t.data}).catch(function(t){r[e]||(r[e]={}),r[e][i]=null})}},removeDictionary:function(t){r[t]&&delete r[t]},getDictionary:function(t,e){return e&&r[t]?r[t][e]:r[t]},getLanguage:function(){return i},getLanguages:function(){return o},setLanguage:c,translate:function(t,e){if(e&&r[e])return r[e][i]?u(t,r[e][i]):r[e].en?u(t,r[e].en):t;var n,o=t;for(n in r){if((o=(o=u(t,r[n][i]))===t?u(t,r[n].en):o)!==t)break;o=t}return o},isLanguageSupported:a,getLanguageName:function(t){for(var e=0;e<o.length;e++)if(t===o[e].value)return o[e].label;return null},destroy:function(){r={}}}}function n(o,i,r){return function(t,e,n){e=o.translate(t,e);return n&&(a.isObject(n)||(n=i(n)(this)),e=r(e)(n)),e}}t.factory("i18nService",e),t.filter("translate",n),e.$inject=["$http","$cookies"],n.$inject=["i18nService","$parse","$interpolate"]}(angular),function(f){function t(l,c){var u="/be/",s={};function r(t,e){t||e?(e=e||"core",t?s[e]&&s[e][t]&&delete s[e][t]:s[e]={}):s=[]}function d(e,n,t,o){var i=c.defer(),o=o?{timeout:o}:{},r=s[n=n||"core"],a=JSON.stringify(t);return o.params=t,r&&r[e]&&r[e][a]?i.resolve(f.copy(r[e][a])):(t=u+("core"!==n?n+"/":"")+e,l.get(t,o).then(function(t){(r=r||(s[n]={}))[e]||(r[e]={}),r[e][a]=f.copy({data:t.data}),i.resolve({data:t.data})})),i.promise}return{addEntities:function(t,e,n){var o=e?e+"/":"";return r(t,e),l.put(u+o+t,n)},updateEntity:function(t,e,n,o){var i=e?e+"/":"";return r(t,e),l.post(u+i+t+"/"+n,o)},removeEntities:function(t,e,n){var o=e?e+"/":"";return r(t,e),l.delete(u+o+t+"/"+n)},getEntity:function(t,e,n){return l.get(u+(e?e+"/":"")+t+"/"+n)},getEntities:d,getAllEntities:function(t,n,o,i){var r=0,a=[],l=c.defer();return o=o||{},function e(){o.page=r,o.limit=void 0,d(t,n,o,i).then(function(t){a=a.concat(t.data.entities),r<t.data.pagination.pages-1?(r++,e()):l.resolve({data:{entities:a}})})}(),l.promise},deleteCache:r}}f.module("ov.entity",[]).factory("entityService",t),t.$inject=["$http","$q"]}(angular),function(){function t(i,r){function a(t){return t=i.alerts.indexOf(t),i.alerts.splice(t,1)}return i.alerts=[],{add:function(t,e,n){var o={type:t,msg:e,close:function(){return o.timeout&&r.cancel(this.timeout),a(this)}};n&&(o.timeout=r(function(){a(o)},n)),i.alerts.push(o)},closeAll:function(){i.alerts=[]}}}angular.module("ov.alert",[]).factory("alertService",t),t.$inject=["$rootScope","$timeout"]}(),function(){function t(e){var n=null;return{initSocket:function(t){return n=n||io(e.protocol()+"://"+e.host()+":"+openVeoSettings.socketServerPort+t,{withCredentials:!0})}}}angular.module("ov.socket",[]).factory("SocketFactory",t),t.$inject=["$location"]}(),function(s){var t=s.module("ov.tableForm",["ov.i18n","ngSanitize"]);function e(e){var t={broadcast:function(t){e.$broadcast("reloadDataTable",{callback:t})}};return t}function n(){var t=this;t.today=function(){t.dt=new Date},t.today(),t.clear=function(){t.dt=null},t.toggleMax=function(){t.maxDate=t.maxDate?null:new Date},t.toggleMax(),t.open=function(){t.status.opened=!0},t.dateOptions={startingDay:1},t.status={opened:!1}}function o(i,e,n,o){var t,r=this,a=i.editFormContainer.entityType||"",l=i.editFormContainer.pluginName;this.options={formState:{showForm:!1}},i.$watch("fec.options.formState.showForm",function(){s.forEach(r.fields,function(t){t.runExpressions&&t.runExpressions()})},!0),i.$on("$destroy",function(){r.cancelForm()}),this.init=function(t){r.model=t,i.editFormContainer.init&&i.editFormContainer.init(t),r.fields=i.editFormContainer.fields},this.conditionEditDetail=i.editFormContainer.conditionEditDetail||function(){return!0},this.updateRowBeforeEdit=function(t,e){i.editFormContainer.updateRowObjectBeforeEdit&&i.editFormContainer.updateRowObjectBeforeEdit(t,e);var n,o=!1;for(n in e)t[n]&&"object"!=typeof t[n]&&t[n]!=e[n]&&(o=!0,t[n]=e[n]);return o},this.onSubmit=function(){r.model.saving=!0,i.editFormContainer.onSubmit(r.model).then(function(){try{r.options.updateInitialValue()}catch(t){}r.model.saving=!1,r.options.formState.showForm=!1,o.broadcast()},function(){r.options.resetModel(),r.model.saving=!1,r.model=t})},this.editForm=function(){t=s.copy(r.model),n.getEntity(a,l,r.model.id).then(function(t){if(!t.data.entity)return n.deleteCache(a,l),i.$emit("setAlert","danger",e("translate")("CORE.UI.WARNING_ENTITY_DELETED"),8e3),void o.broadcast();t=t.data.entity;r.updateRowBeforeEdit(r.model,t)&&(i.$emit("setAlert","warning",e("translate")("CORE.UI.WARNING_ENTITY_MODIFIED"),8e3),n.deleteCache(a,l)),i.editFormContainer.pendingEdition=!0,r.options.formState.showForm=!0})},this.cancelForm=function(){i.editFormContainer.pendingEdition=!1,r.options.formState||(r.options.formState={}),r.options.formState.showForm=!1,r.options.resetModel(),r.model=t}}function i(t,e,n){var o=this;this.model=t.addFormContainer.model,this.fields=t.addFormContainer.fields,this.isAddButtonDisabled=!1,this.onSubmit=function(){o.isAddButtonDisabled=!0,t.addFormContainer.onSubmit(o.model).then(function(){o.options.resetModel(),n.broadcast(),t.$emit("setAlert","success",e("translate")("CORE.UI.SAVE_SUCCESS"),4e3),o.isAddButtonDisabled=!1},function(){o.isAddButtonDisabled=!1})},this.options={}}function r(n,o,i,r){var a=this;this.rows=n.tableContainer.rows||{},this.entityType=n.tableContainer.entityType||"",this.filterBy=s.copy(n.tableContainer.filterBy),this.header=n.tableContainer.header||[],this.actions=n.tableContainer.actions||[],this.notSortBy=(n.tableContainer.init?n.tableContainer.init.notSortBy:[]).concat(["action"]),this.conditionToggleDetail=n.editFormContainer.conditionToggleDetail||function(){return!0},this.showSelectAll=n.tableContainer.showSelectAll||!0,this.isRowSelected=!1,this.init={count:10,page:1,sortBy:n.tableContainer.init?n.tableContainer.init.sortBy:this.header[0].key,sortOrder:n.tableContainer.init?n.tableContainer.init.sortOrder:"asc",filterBase:!1},this.customTheme={iconUp:"glyphicon glyphicon-triangle-bottom",iconDown:"glyphicon glyphicon-triangle-top",listItemsPerPage:[5,10,20,30],itemsPerPage:10,loadOnInit:!0,cellTheme:n.tableContainer.cellTheme},this.showSelectAll&&(this.customTheme.templateHeadUrl="views/elements/head.html"),this.customTheme.templateUrl="views/elements/pagination.html";var l=n.tableContainer.pluginName,c=r.defer(),u=[];this.getResource=function(t,e){var n={};return c&&(c.promise.status=!0,c.resolve()),c=r.defer(),n.limit=e.count,n.page=Math.max(e.page-1,0),n.sortBy=e.sortBy,n.sortOrder="dsc"===e.sortOrder?"desc":"asc",a.filterBy.forEach(function(t){t.value&&""!=t.value&&(n[t.key]=t.getValue?t.getValue(t.value):t.value)}),i.getEntities(a.entityType,l,n,c.promise).then(function(t){if(a.rows=t.data.entities,a.selectAll=!1,a.isRowSelected=!1,t.data.pagination.page++,u.length){for(var e=0;e<u.length;e++)u[e]();u=[]}return{rows:a.rows,header:a.header,pagination:t.data.pagination}},function(t){return{}})},this.toggleRowDetails=function(e){a.conditionToggleDetail(e)&&s.forEach(a.rows,function(t){t.opened=t.id===e.id&&!t.opened,n.editFormContainer.pendingEdition=!1})},this.reloadCallback=function(){a.selectAll=!1},n.$on("reloadDataTable",function(t,e){e.callback&&u.push(e.callback),a.reloadCallback()}),this.commonActionExist=!1,this.checkAll=function(){a.commonActionExist=!1,s.forEach(a.rows,function(t){t.selected=a.selectAll}),a.isRowSelected=a.selectAll},this.check=function(){var e=!0;a.isRowSelected=!1,a.commonActionExist=!1,s.forEach(a.rows,function(t){t.selected?a.isRowSelected=!0:e=!1}),a.selectAll=e},this.verifyCondition=function(t){for(var e=!0,n=0;n<a.rows.length&&e;n++){var o=a.rows[n];o.selected&&(o=!t.condition||t.condition(o),e=e&&t.global&&o)}return a.commonActionExist=a.commonActionExist||e,e},this.prepareSingleAction=function(t,e){t.warningPopup?a.openModal(t.callback,e):t.callback(e,a.reloadCallback)},this.executeGlobalAction=function(t){var e=a.getSelectedId();a.openModal(t.global,e)},this.getSelectedId=function(){for(var t=[],e=0;e<a.rows.length;e++){var n=a.rows[e];n.selected&&t.push(n.id)}return t},this.openModal=function(t,e){o.open({templateUrl:"tableModal.html",controller:"ModalInstanceTableController"}).result.then(function(){t(e,a.reloadCallback)},function(){})}}function a(t,e){t.ok=function(){e.close(!0)},t.cancel=function(){e.dismiss("cancel")}}t.controller("DataTableController",r),t.controller("FormEditController",o),t.controller("FormAddController",i),t.controller("ModalInstanceTableController",a),t.controller("DatePickerController",n),t.factory("tableReloadEventService",e),r.$inject=["$scope","$uibModal","entityService","$q"],o.$inject=["$scope","$filter","entityService","tableReloadEventService"],i.$inject=["$scope","$filter","tableReloadEventService"],a.$inject=["$scope","$uibModalInstance"],n.$inject=["$scope"],e.$inject=["$rootScope"]}(angular),angular.module("ov.util",[]),function(){function t(n){return{buildSelectOptions:function(t){var e=[{name:n("translate")("CORE.UI.NONE"),value:null}];return t.forEach(function(t){e.push({name:t.name,value:t.id})}),e}}}angular.module("ov.util").factory("utilService",t),t.$inject=["$filter"]}(),function(){function t(){return{setUrlParameter:function(t,e,n){var o,i,r={},a=[],l=t.match(/([^?#]*)(?:\?([^#]*))?(?:#(.*))?/);if(!l)throw new TypeError(t+" is not a valid URL");for(i in o=l[1],t=l[2],l=l[3],t&&(a=t.split("&")).forEach(function(t){t=t.split("=");r[t[0]]=t[1]}),r[e]=n,a=[],r)a.push(i+"="+r[i]);return a.length&&(o+="?"+a.join("&")),l&&(o+="#"+l),o}}}angular.module("ov.util").factory("OvUrlFactory",t),t.$inject=[]}();