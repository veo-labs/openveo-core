<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: entity/EntityApp.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: entity/EntityApp.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

/**
 * Manage OpenVeo entities described in conf.js.
 *
 * @module ov/entity
 */

(function(angular) {
  var app = angular.module('ov.entity', []);

  /**
   * Defines an entity service to create / update or remove an entity.
   *
   * @example
   * MyAngularObject.$inject = ['entityService'];
   *
   * @class EntityService
   */
  function EntityService($http, $q) {
    var basePath = '/be/';
    var entityCache = {};

    /**
     * Deletes cache of the given entity type.
     *
     * @memberof module:ov/entity~EntityService
     * @instance
     * @param {String} [entityType] The entity type or null to remove all cache
     * @param {String} [pluginName] Plugin name the entity belongs to, null for core
     */
    function deleteCache(entityType, pluginName) {
      if (!entityType &amp;&amp; !pluginName) {
        entityCache = [];
        return;
      }

      if (!pluginName) pluginName = 'core';

      if (entityType) {
        if (entityCache[pluginName] &amp;&amp; entityCache[pluginName][entityType])
          delete entityCache[pluginName][entityType];
      } else
        entityCache[pluginName] = {};
    }

    /**
     * Adds new entities.
     *
     * @memberof module:ov/entity~EntityService
     * @instance
     * @async
     * @param {String} entityType The type of the entities
     * @param {String} [pluginName="core"] Plugin name the entities belong to
     * @param {Array} data The list of entities
     * @return {Promise} The HTTP promise
     */
    function addEntities(entityType, pluginName, data) {
      var pluginPath = (!pluginName) ? '' : pluginName + '/';
      deleteCache(entityType, pluginName);
      return $http.put(basePath + pluginPath + entityType, data);
    }

    /**
     * Updates an entity.
     *
     * @memberof module:ov/entity~EntityService
     * @instance
     * @async
     * @param {String} entityType Type of entity
     * @param {String} [pluginName] Plugin name the entity belongs to, null for core
     * @param {String} id The id of the entity to update
     * @param {String} data Data description object of the entity
     * @return {Promise} The HTTP promise
     */
    function updateEntity(entityType, pluginName, id, data) {
      var pluginPath = (!pluginName) ? '' : pluginName + '/';
      deleteCache(entityType, pluginName);
      return $http.post(basePath + pluginPath + entityType + '/' + id, data);
    }

    /**
     * Removes entities.
     *
     * @memberof module:ov/entity~EntityService
     * @instance
     * @async
     * @param {String} entityType Type of the entities
     * @param {String} [pluginName="core"] Plugin name the entity belongs to
     * @param {String} ids The comma separated list of entity ids to remove
     * @return {Promise} The HTTP promise
     */
    function removeEntities(entityType, pluginName, ids) {
      var pluginPath = (!pluginName) ? '' : pluginName + '/';
      deleteCache(entityType, pluginName);
      return $http.delete(basePath + pluginPath + entityType + '/' + ids);
    }

    /**
     * Fetch an entity by Id.
     *
     * @memberof module:ov/entity~EntityService
     * @instance
     * @async
     * @param {String} entityType Type of entity
     * @param {String} [pluginName] Plugin name the entity belongs to, null for core
     * @param {String} id The Id of the entity to fetch
     * @return {Promise} The HTTP promise
     */
    function getEntity(entityType, pluginName, id) {
      var pluginPath = (!pluginName) ? '' : pluginName + '/';
      return $http.get(basePath + pluginPath + entityType + '/' + id);
    }

    /**
     * Gets entities.
     *
     * @example
     * // Get the first page of Web Service applications containing string "Search string" sorted by name with 10
     * // applications per page. Field "name" won't be returned.
     *
     * var params = {
     *   query: 'Search string',
     *   limit: 10,
     *   page: 0,
     *   sortBy: 'name',
     *   sortOrder: 'desc',
     *   exclude: ['name']
     * };
     * getEntities('applications', 'core', params);
     *
     * @memberof module:ov/entity~EntityService
     * @instance
     * @async
     * @param {String} entityType Type of entity
     * @param {String} [pluginName] Plugin name the entity belongs to, null for core
     * @param {Object} param Request parameters
     * @param {(String|Array)} [param.include] The list of fields to include from returned entities
     * @param {(String|Array)} [param.exclude] The list of fields to exclude from returned entities. Ignored if
     * include is also specified.
     * @param {String} [param.query] Search query to search on entities searchable fields
     * @param {Number} [param.page=0] The expected page in pagination system
     * @param {Number} [param.limit=10] The maximum number of expected results
     * @param {String} [param.sortBy] The field to sort by
     * @param {String} [param.sortOrder="desc"] The sort order (either "asc" or "desc")
     * @param {Promise} [canceller] The HTTP promise to cancel request if needed, resolve the promise to cancel the
     * request
     * @return {Promise} The HTTP promise
     */
    function getEntities(entityType, pluginName, param, canceller) {
      var deferred = $q.defer();
      var options = {};
      if (canceller) {
        options = {timeout: canceller};
      }
      if (!pluginName) pluginName = 'core';
      var pluginCache = entityCache[pluginName];

      var cacheId = JSON.stringify(param);
      options.params = param;

      // Return the data if we already have it
      if (pluginCache &amp;&amp; pluginCache[entityType] &amp;&amp; pluginCache[entityType][cacheId]) {
        deferred.resolve(angular.copy(pluginCache[entityType][cacheId]));
      } else {
        var path = basePath + ((pluginName !== 'core') ? pluginName + '/' : '') + entityType;
        $http.get(path, options).then(function(response) {
          if (!pluginCache) pluginCache = entityCache[pluginName] = {};
          if (!pluginCache[entityType]) pluginCache[entityType] = {};

          pluginCache[entityType][cacheId] = angular.copy({
            data: response.data
          });

          deferred.resolve({
            data: response.data
          });
        });
      }
      return deferred.promise;
    }

    /**
     * Gets all entities of a specific type.
     *
     * This should be used wisely as it may launch several requests to get all entities which could lead
     * to real performance issues. Use it when you are sure about the total number of entities.
     *
     * @memberof module:ov/entity~EntityService
     * @instance
     * @async
     * @param {String} entityType Type of entity
     * @param {String} [pluginName="core"] Plugin name the entity belongs to
     * @param {Object} param Request parameters
     * @param {(String|Array)} [param.include] The list of fields to include from returned entities
     * @param {(String|Array)} [param.exclude] The list of fields to exclude from returned entities. Ignored if
     * include is also specified.
     * @param {String} [param.query] Search query to search on entities searchable fields
     * @param {String} [param.sortBy] The field to sort by
     * @param {String} [param.sortOrder="desc"] The sort order (either "asc" or "desc")
     * @param {Promise} [canceller] The HTTP promise to cancel request if needed, resolve the promise to cancel the
     * request
     * @return {Promise} The HTTP promise
     */
    function getAllEntities(entityType, pluginName, param, canceller) {
      var page = 0;
      var allEntities = [];
      var deferred = $q.defer();
      param = param || {};

      /**
       * Gets the next page of entities.
       */
      function getNextPages() {
        param.page = page;
        param.limit = undefined;

        getEntities(
          entityType,
          pluginName,
          param,
          canceller
        ).then(function(response) {
          allEntities = allEntities.concat(response.data.entities);

          if (page &lt; response.data.pagination.pages - 1) {

            // There is an other page
            // Get next page
            page++;
            getNextPages();

          } else {

            // No more page
            // End it
            deferred.resolve({
              data: {
                entities: allEntities
              }
            });
          }
        });
      }

      getNextPages();
      return deferred.promise;
    }

    return {
      addEntities: addEntities,
      updateEntity: updateEntity,
      removeEntities: removeEntities,
      getEntity: getEntity,
      getEntities: getEntities,
      getAllEntities: getAllEntities,
      deleteCache: deleteCache
    };

  }

  app.factory('entityService', EntityService);
  EntityService.$inject = ['$http', '$q'];

})(angular);
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-ov.html">ov</a></li><li><a href="module-ov_alert.html">ov/alert</a></li><li><a href="module-ov_authentication.html">ov/authentication</a></li><li><a href="module-ov_entity.html">ov/entity</a></li><li><a href="module-ov_i18n.html">ov/i18n</a></li><li><a href="module-ov_socket.html">ov/socket</a></li><li><a href="module-ov_storage.html">ov/storage</a></li><li><a href="module-ov_util.html">ov/util</a></li></ul><h3>Classes</h3><ul><li><a href="module-ov_alert-AlertService.html">ov/alert~AlertService</a></li><li><a href="module-ov_authentication-AuthenticationService.html">ov/authentication~AuthenticationService</a></li><li><a href="module-ov_entity-EntityService.html">ov/entity~EntityService</a></li><li><a href="module-ov_i18n-I18nService.html">ov/i18n~I18nService</a></li><li><a href="module-ov_i18n-TranslateFilter.html">ov/i18n~TranslateFilter</a></li><li><a href="module-ov_socket-SocketFactory.html">ov/socket~SocketFactory</a></li><li><a href="module-ov_storage-StorageProvider.html">ov/storage~StorageProvider</a></li><li><a href="module-ov_util-OvUrlFactory.html">ov/util~OvUrlFactory</a></li><li><a href="module-ov_util-UtilService.html">ov/util~UtilService</a></li><li><a href="module-ov-ApplicationService.html">ov~ApplicationService</a></li><li><a href="module-ov-ErrorInterceptor.html">ov~ErrorInterceptor</a></li><li><a href="module-ov-MenuService.html">ov~MenuService</a></li><li><a href="module-ov-ovAutoComplete.html">ov~ovAutoComplete</a></li><li><a href="module-ov-ovDateTimePicker.html">ov~ovDateTimePicker</a></li><li><a href="module-ov-ovMatch.html">ov~ovMatch</a></li><li><a href="module-ov-ovMultiCheckBox.html">ov~ovMultiCheckBox</a></li><li><a href="module-ov-ovTags.html">ov~ovTags</a></li><li><a href="module-ov-TruncateFilter.html">ov~TruncateFilter</a></li><li><a href="module-ov-userService.html">ov~userService</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Fri Mar 11 2022 07:34:42 GMT+0100 (Central European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
