<!DOCTYPE html>
<html lang="en" class="yui-overrride">
<head>
    <meta charset="utf-8">
    <title>app\client\admin\js\i18n\I18nApp.js - OpenVeo AngularJS back end</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1 class="blue-main-title">OpenVeo AngularJS back end</h1>
        </div>
        <div class="yui3-u-1-4 version project-version">
            API Docs for: 1.0.0
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/alertService.html">alertService</a></li>
                                <li><a href="../classes/applicationService.html">applicationService</a></li>
                                <li><a href="../classes/authenticationService.html">authenticationService</a></li>
                                <li><a href="../classes/entityService.html">entityService</a></li>
                                <li><a href="../classes/i18nService.html">i18nService</a></li>
                                <li><a href="../classes/menuService.html">menuService</a></li>
                                <li><a href="../classes/storageProvider.html">storageProvider</a></li>
                                <li><a href="../classes/translateFilter.html">translateFilter</a></li>
                                <li><a href="../classes/truncateFilter.html">truncateFilter</a></li>
                                <li><a href="../classes/userService.html">userService</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/ov.html">ov</a></li>
                                <li><a href="../modules/ov.alert.html">ov.alert</a></li>
                                <li><a href="../modules/ov.authentication.html">ov.authentication</a></li>
                                <li><a href="../modules/ov.entity.html">ov.entity</a></li>
                                <li><a href="../modules/ov.i18n.html">ov.i18n</a></li>
                                <li><a href="../modules/ov.storage.html">ov.storage</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: app\client\admin\js\i18n\I18nApp.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x27;use strict&#x27;;

/**
 * Control back end internationalization.
 *
 * @module ov.i18n
 * @main ov.i18n
 */

(function(angular) {
  var app = angular.module(&#x27;ov.i18n&#x27;, [&#x27;ngCookies&#x27;]);

  /**
   * Defines an internationalization service to manage string translations.
   *
   * @class i18nService
   */
  function I18nService($http, $cookies) {
    var currentLanguage = $cookies.get(&#x27;language&#x27;) || navigator.language || navigator.browserLanguage;
    var translations = {};
    var supportedLanguages = [];

    /**
     * Adds a new dictionary, to the translation table, for the current
     * language.
     * A dictionary is referenced by its name and contains a JSON
     * representation of all its translations.
     * If dictionary does not exist yet, get it from the server.
     *
     * @param {String} name The name of the dictionary to retrieve from
     * server
     * @param {Boolean} [admin] true to retrieve a dictionary for the back
     * office part (which requires authentication), false to get a
     * dictionary without access restriction
     * @return {Promise} The promise to retrieve the dictionary
     * @method addDictionary
     */
    function addDictionary(name, admin) {

      // Dictionary for the currentLanguage
      if (name &amp;&amp; (!translations[name] || translations[name][currentLanguage] === undefined)) {
        admin || (admin = false);

        var path = admin ? &#x27;/be/&#x27; : &#x27;/&#x27;;
        path += &#x27;getDictionary/&#x27; + name + &#x27;/&#x27; + currentLanguage;

        // Get dictionary
        return $http.get(path).success(function(translation) {
          translations[name] || (translations[name] = {});
          translations[name][currentLanguage] = translation;
        }).error(function() {
          translations[name] || (translations[name] = {});
          translations[name][currentLanguage] = null;
        });
      }
    }

    /**
     * Removes a dictionary from cache.
     *
     * @param {String} name The dictionary name
     * @method removeDictionary
     */
    function removeDictionary(name) {
      translations[name] &amp;&amp; (delete translations[name]);
    }

    /**
     * Gets a dictionary with all its languages or just for the specific language.
     *
     * @param {String} name The dictionary name
     * @param {String} language An optional language to retrieve
     * @return {Object} The translations contained in the dictionary
     * @method getDictionary
     */
    function getDictionary(name, language) {
      if (language &amp;&amp; translations[name])
        return translations[name][language];

      return translations[name];
    }

    /**
     * Gets current language.
     *
     * @return {String} The current language country code (e.g en-US)
     * @method getLanguage
     */
    function getLanguage() {
      return currentLanguage;
    }

    /**
     * Gets supported languages.
     *
     * @return {Array} The list of supported languages
     * @method getLanguages
     */
    function getLanguages() {
      return supportedLanguages;
    }

    /**
     * Tests if a language is supported.
     *
     * @param {String} language The language code to test
     * @return {Boolean} true if supported, false otherwise
     * @method isLanguageSupported
     */
    function isLanguageSupported(language) {
      for (var i = 0; i &lt; supportedLanguages.length; i++) {
        if (language === supportedLanguages[i].value)
          return true;
      }

      return false;
    }

    /**
     * Sets current language to active and the other one to inactive.
     */
    function setActiveLanguage() {
      for (var i = 0; i &lt; supportedLanguages.length; i++)
        supportedLanguages[i].active = supportedLanguages[i].value === currentLanguage;
    }

    /**
     * Sets current language.
     *
     * @param {String} language The current language country code (e.g en-CA)
     * @method setLanguage
     */
    function setLanguage(language) {
      if (isLanguageSupported(language)) {
        currentLanguage = language;
        $cookies.put(&#x27;language&#x27;, currentLanguage);
        setActiveLanguage(currentLanguage);
      }
    }

    /**
     * Gets full name of a language by its code.
     *
     * @param {String} language The language code
     * @return {String} The language full name
     * @method getLanguageName
     */
    function getLanguageName(language) {
      for (var i = 0; i &lt; supportedLanguages.length; i++) {
        if (language === supportedLanguages[i].value)
          return supportedLanguages[i].label;
      }

      return null;
    }

    /**
     * Looks for a translation inside a translations object.
     *
     * @example
     *     getTranslationFromDictionary(&#x27;HOME.LOGIN&#x27;, { &#x27;HOME&#x27; : { &#x27;LOGIN&#x27; : &#x27;The translation to look for&#x27; } });
     *
     * @param {String} id The id to retrieve (e.g. HOME.LOGIN)
     * @param {Object} dictionary Translations where to look for
     * @return {String} The translated text corresponding to the given id
     * in the translations or the unchanged id if no translation found
     */
    function getTranslationFromDictionary(id, dictionary) {
      if (id &amp;&amp; dictionary) {
        var properties = id.split(&#x27;.&#x27;);
        var property = dictionary;

        for (var i = 0; i &lt; properties.length; i++) {
          if (property[properties[i]])
            property = property[properties[i]];
        }
        return (typeof property === &#x27;string&#x27;) ? property : id;
      }

      return id;
    }

    /**
     * Translates the given id using current language.
     *
     * @param {String} id The id of the translation
     * @param {String} [dictionary] The name of a particular dictionary if several dictionaries are loaded
     * @method translate
     */
    function translate(id, dictionary) {

      // If the dictionary exists, get translation from
      // that dictionary
      if (dictionary &amp;&amp; translations[dictionary]) {

        // Language exists for the dictionary
        if (translations[dictionary][currentLanguage])
          return getTranslationFromDictionary(id, translations[dictionary][currentLanguage]);

        // Language does not exist
        // Use english language as default
        else if (translations[dictionary][&#x27;en&#x27;])
          return getTranslationFromDictionary(id, translations[dictionary][&#x27;en&#x27;]);

        return id;
      } else {

        // Iterate through the list of dictionaries to find a match
        // for the given id
        var translatedText = id;

        for (var i in translations) {
          translatedText = getTranslationFromDictionary(id, translations[i][currentLanguage]);

          // Language does not exist
          // Use english language as default
          if (translatedText === id)
            translatedText = getTranslationFromDictionary(id, translations[i][&#x27;en&#x27;]);

          if (translatedText !== id)
            break;
          else
            translatedText = id;
        }

        return translatedText;
      }
    }

    /**
     * Destroys I18nService cached data.
     *
     * @method destroy
     */
    function destroy() {
      translations = {};
    }

    /**
     * Initializes supported languages.
     */
    function init() {
      supportedLanguages = [
        {
          value: &#x27;en&#x27;,
          label: &#x27;LANGUAGE.ENGLISH&#x27;
        },
        {
          value: &#x27;fr&#x27;,
          label: &#x27;LANGUAGE.FRENCH&#x27;
        }
      ];

      // Verify if current language is supported, otherwise
      // set language to the first one in the list of supported languages
      if (!isLanguageSupported(currentLanguage)) {
        var language = currentLanguage.split(&#x27;-&#x27;)[0];
        if (isLanguageSupported(language))
          setLanguage(language);
        else
          setLanguage(supportedLanguages[0].value);
      }
      else
        setActiveLanguage();
    }

    init();

    return {
      addDictionary: addDictionary,
      removeDictionary: removeDictionary,
      getDictionary: getDictionary,
      getLanguage: getLanguage,
      getLanguages: getLanguages,
      setLanguage: setLanguage,
      translate: translate,
      isLanguageSupported: isLanguageSupported,
      getLanguageName: getLanguageName,
      destroy: destroy
    };
  }

  /**
   * Defines a filter to translate an id, contained inside a dictionary,
   * into the appropriated text.
   *
   * @class translateFilter
   */
  function TranslateFilter(i18nService) {

    /**
     * Translates an id, contained inside a dictionary, into the appropriated text.
     *
     * **translate** filter helps translate a dictionary id.
     *
     * If id is not found in the specified dictionary for the actual language, it will search in the english version
     * of the dictionary.&lt;br/&gt;
     * If id is not found in the dictionary, the id is not translated and will be printed as is.&lt;br/&gt;
     *
     * If the dictionary is not specified, it will look for the id in all loaded dictionaries.&lt;br/&gt;
     * For each dictionary analyzed, if the id does not exist in the actual language it will try in the english
     * version of the dictionary.&lt;br/&gt;
     * After all, if id is not found in any versions of the list of dictionaries, the id is not translated and will
     * be printed as is.
     *
     * @example
     *     // Let&#x27;s pretend that with have a dictionary named &quot;login&quot; with the following structure :
     *     // {
     *     //   &quot;LOGIN&quot; : {
     *     //     &quot;PAGE_TITLE&quot; : &quot;Openveo - Sign In&quot;,
     *     //     &quot;DESCRIPTION&quot; : &quot;Login page description&quot;,
     *     //     &quot;LOGIN&quot; : &quot;User&quot;,
     *     //   }
     *     // }
     *
     *     // Search for id LOGIN.DESCRIPTION in dictionary &quot;login&quot; : &quot;Login page description&quot;
     *
     *     // In HTML
     *     // &lt;label ng-bind=&quot;&#x27;LOGIN.DESCRIPTION&#x27; | translate:login&quot;&gt;&lt;/label&gt;
     *
     *     // In JavaScript
     *     $filter(&#x27;translate&#x27;)(&#x27;LOGIN.DESCRIPTION&#x27;, &#x27;login&#x27;);
     *
     * @param {String} id The id of the translation
     * @param {String} dictionaryName An optional dictionary to prevent looking in all dictionaries
     * @method translate
     */
    return function(id, dictionaryName) {
      return i18nService.translate(id, dictionaryName);
    };

  }

  app.factory(&#x27;i18nService&#x27;, I18nService);
  app.filter(&#x27;translate&#x27;, TranslateFilter);
  I18nService.$inject = [&#x27;$http&#x27;, &#x27;$cookies&#x27;];
  TranslateFilter.$inject = [&#x27;i18nService&#x27;];

})(angular);

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
