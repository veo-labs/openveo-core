<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Write a plugin - Openveo Core</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Write a plugin";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Openveo Core</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">INTRODUCTION</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>USERS</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../prerequisites/">Prerequisites</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../getting-started/">Getting started</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../web-service/">Web Service</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../advanced-configuration/">Advanced configuration</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../scalability/">Scalability</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../production/">Production</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>DEVELOPERS</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../basics/">The basics</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../prerequisites/">Prerequisites</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../installation/">Installation</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../conf/">conf.json</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../back-end/">Back end AngularJS</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Write a plugin</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#introduction">Introduction</a></li>
                
            
                <li class="toctree-l3"><a href="#create-plugins-directory">Create plugin's directory</a></li>
                
            
                <li class="toctree-l3"><a href="#create-plugins-main-file">Create plugin's main file</a></li>
                
            
                <li class="toctree-l3"><a href="#create-plugins-entry-point">Create plugin's entry point</a></li>
                
            
                <li class="toctree-l3"><a href="#create-routes">Create routes</a></li>
                
                    <li><a class="toctree-l4" href="#create-the-controller">Create the controller</a></li>
                
                    <li><a class="toctree-l4" href="#create-a-template">Create a template</a></li>
                
            
                <li class="toctree-l3"><a href="#add-directory-of-resources">Add directory of resources</a></li>
                
            
                <li class="toctree-l3"><a href="#add-page-to-the-back-end">Add page to the back end</a></li>
                
                    <li><a class="toctree-l4" href="#configure-page">Configure page</a></li>
                
                    <li><a class="toctree-l4" href="#create-angularjs-module">Create AngularJS module</a></li>
                
                    <li><a class="toctree-l4" href="#translate-your-back-end-pages">Translate your back end pages</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../compilation/">CSS / SASS / JS compilation</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../template-engine/">Template engine</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../logger/">Logger</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../i18n/">I18N and I10N</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../coding-standards/">Coding standards</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../unit-tests/">Unit tests</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Openveo Core</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>DEVELOPERS &raquo;</li>
        
      
    
    <li>Write a plugin</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/veo-labs/openveo-core" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="introduction">Introduction</h1>
<p>As OpenVeo server starts, all plugins found in <strong>node_modules/@openveo/</strong> will be loaded. Each plugin can add routes and add its own pages in the back end.</p>
<p>Let's pretend we want to create a plugin called <strong>book</strong> to manage a list of books.</p>
<h1 id="create-plugins-directory">Create plugin's directory</h1>
<p>The first thing we need is a plugin's directory, create a directory <strong>book</strong> under <strong>node_modules/@openveo/</strong> (<strong>node_modules/@openveo/book</strong>).</p>
<h1 id="create-plugins-main-file">Create plugin's main file</h1>
<p>A plugin must have a class which extends <strong>Plugin</strong> class.</p>
<p>Create a file <strong>BookPlugin.js</strong> at the root of your plugin directory.</p>
<pre><code class="javascript">'use strict';

// Module dependencies
var util = require('util');
var express = require('express');
var openVeoAPI = require('@openveo/api');

/**
 * Creates a BookPlugin.
 */
function BookPlugin() {

  // Creates a public router
  // It will be automatically mounted on /book/ by the core
  this.router = express.Router();

  // Creates a private router
  // All routes associated to the private router require a back end authentication
  // It will be automatically mounted on /be/book/ by the core
  this.privateRouter = express.Router();

  // Creates a Web Service router
  // All routes associated to the Web Service router will be part of the Web Service
  // It will be automatically mounter on /book/ by the core (but on another server)
  this.webServiceRouter = express.Router();

}

// Expose BookPlugin
module.exports = BookPlugin;

// Extends Plugin
util.inherits(BookPlugin, openVeoAPI.Plugin);

/**
 * Optional &quot;start&quot; method automatically called by core application
 * after plugin is loaded.
 */
BookPlugin.prototype.start = function() {
  console.log('Book plugin loaded');
};
</code></pre>

<p>If you don't want to expose public routes, private routes or Web Service routes, just remove the corresponding router.</p>
<h1 id="create-plugins-entry-point">Create plugin's entry point</h1>
<p>A plugin must have an entry point. Either the one described in your <strong>package.json</strong> file (if you have one) or an <strong>index.js</strong> file. This is the file loaded by the core.</p>
<p>Create a file <strong>index.js</strong> at the root of your plugin directory.</p>
<pre><code class="javascript">'use strict';

// Module dependencies
var path = require('path');

// Set module root directory
process.rootBook = __dirname;

// Define a new method on process object to be able to require
// a module with a path relative to plugin's root directory
process.requireBook = function(filePath) {
  return require(path.join(process.requireBook, filePath));
};

// Expose the BookPlugin
module.exports = process.requireBook('app/server/BookPlugin.js');
</code></pre>

<p>As the plugin will be loaded by OpenVeo core, root of the OpenVeo application will be the root of OpenVeo core and not the root of your plugin. To avoid confusion and collision between the core and your plugin, define a property process.root<strong>PLUGIN_NAME</strong> to have a reference to the root of your plugin.</p>
<p>A best practice is to also add a require<strong>PLUGIN_NAME</strong> function to load your JavaScript files with paths relative to the root of your plugin.</br>
For example, if you want to load a file <strong>dir/test.js</strong> from file <strong>dir/subDir/index.js</strong> instead of writing :</p>
<pre><code class="javascript">var test = require('../test.js');
</code></pre>

<p>You can write :</p>
<pre><code class="javascript">var test = process.requireBook('dir/subDir/test.js');
</code></pre>

<p>Like that moving the file <strong>index.js</strong> won't break your code.</p>
<p>At this point you have a functional plugin, but it does nothing. When launching the server, the plugin is loaded by the core and message '<em>Book plugin loaded</em>' is displayed in the console.</p>
<h1 id="create-routes">Create routes</h1>
<p>To add features to our Book plugin we need to define routes.</p>
<p>Create a file <strong>conf.json</strong> at the root of your plugin directory. Take a look at <a href="../../developers/conf">conf.json documentation</a> for more details about <strong>conf.json</strong> file.</p>
<p>For our example, let's create a public route, a private route and a Web Service route.</p>
<pre><code class="json">{
  &quot;routes&quot; : {
    &quot;public&quot; : {
      &quot;get /:id&quot; : &quot;controllers/bookController.displayBookAction&quot;
    },
    &quot;private&quot; : {
      &quot;get /read/:id&quot; : &quot;controllers/bookController.readBookAction&quot;
    },
    &quot;ws&quot;: {
      &quot;get /read/:id&quot; : &quot;controllers/bookController.readBookAction&quot;
    }
  }
}
</code></pre>

<p>As a reminder :</p>
<ul>
<li>public routes will be mounted on <strong>/book/</strong></li>
<li>private routes will be mounted on <strong>/be/book/</strong></li>
<li>Web Service routes will be mounted on <strong>/book/</strong> (but on another server)</li>
</ul>
<h2 id="create-the-controller">Create the controller</h2>
<p>3 routes have been defined in <strong>conf.json</strong> :</p>
<ul>
<li><strong>/book/:id</strong> pointing to <strong>controllers/bookController.js</strong>, method <strong>displayBookAction</strong></li>
<li><strong>/book/read/:id</strong> pointing to <strong>controllers/bookController.js</strong>, method <strong>readBookAction</strong></li>
<li><strong>/book/read/:id</strong> pointing to <strong>controllers/bookController.js</strong>, method <strong>readBookAction</strong></li>
</ul>
<p>Create a file <strong>controllers/bookController.js</strong> with <strong>displayBookAction</strong> and <strong>readBookAction</strong> methods :</p>
<pre><code class="javascript">'use strict';

// Module dependencies
var openVeoAPI = require('@openveo/api');

/**
 * Displays a book.
 */
module.exports.displayBookAction = function(request, response, next) {
  var bookId = request.params.id;

  // Retrieve books
  var books = {
    '1': {
      title: 'Journey to the center of the earth',
      summary: 'The story begins in May 1863, in the Lidenbrock house in Hamburg, Germany, with Professor Lidenbrock rushing home to peruse his latest purchase, an original runic manuscript of an Icelandic saga written by Snorri Sturluson (&quot;Heimskringla&quot;; the chronicle of the Norwegian kings who ruled over Iceland).'
    }
  };

  // Display template book.html using Mustache template
  response.render('book', books[bookId]);
};

/**
 * Reads book content and return it as a JSON object.
 */
module.exports.readBookAction = function(request, response, next) {
  var bookId = request.params.id;

  // Retrieve books
  var books = {
    '1': {
      content: 'Journey to the center of the earth'
    }
  };

  response.send({
    book: books[bookId].content
  });

};
</code></pre>

<p>You can now restart your server, connect to the back end (/be/login) and navigate to <strong>/be/book/read/1</strong> to read the book.</p>
<h2 id="create-a-template">Create a template</h2>
<p>The public route <strong>/book/:id</strong> call the <strong>displayBookAction</strong> function on the <strong>bookController</strong>.<br/>
<strong>displayBookAction</strong> needs a template <strong>book.html</strong> to display information about the book.</p>
<p>Create a file <strong>views/book.html</strong> :</p>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;body&gt;
    &lt;div&gt;
      &lt;h1&gt;{{title}}&lt;/h1&gt;
      &lt;p&gt;{{summary}}&lt;/p&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>And add the <strong>views</strong> directory to the list of directories containing Mustache templates (in <strong>conf.json</strong> file) :</p>
<pre><code class="json">{
  &quot;viewsFolders&quot; : [
    &quot;views&quot;
  ]
}
</code></pre>

<p>You can now restart your server and navigate to <strong>/book/1</strong> to have information about the book.</p>
<h1 id="add-directory-of-resources">Add directory of resources</h1>
<p>You can add an <strong>assets</strong> directory at the root of your plugin, all files inside that directory will be served as they are. You can put here images, front JavaScript files, CSS files and so on. The core will mount this directory on <strong>/book/</strong>, thus to access image <strong>assets/test.jpg</strong> you have to call <strong>/book/test.jpg</strong>.</p>
<h1 id="add-page-to-the-back-end">Add page to the back end</h1>
<p>Plugins can add pages to the back end menu.</p>
<h2 id="configure-page">Configure page</h2>
<p>As described in <a href="../../developers/conf#define-back-end-menu-items">conf.json documentation</a> you can add a page to the back end :</p>
<pre><code class="json">{
  &quot;backOffice&quot;: {
    &quot;menu&quot; : [
      {
        &quot;label&quot; : &quot;Books&quot;,
        &quot;subMenu&quot; : [
          {
            &quot;label&quot; : &quot;Configuration&quot;,
            &quot;path&quot; : &quot;config&quot;
          }
        ]
      }
    ]
  }
}
</code></pre>

<h2 id="create-angularjs-module">Create AngularJS module</h2>
<p>As OpenVeo back end is written in AngularJS, we must create an AngularJS module to add pages to the back end.</p>
<p>Create a file <strong>assets/be/js/BookApp.js</strong> :</p>
<pre><code class="javascript">(function(angular) {

  'use strict';

  // Module name must respect the form ov.PLUGIN_DIRECTORY_NAME
  var app = angular.module(&quot;ov.book&quot;, []);

  /**
   * Configures the ov.book application by adding new routes.
   */
  app.config(['$routeProvider', function($routeProvider) {

    // Add route /book/config
    $routeProvider.when('/book/config', {
      templateUrl: '/book/be/views/config.html',
      controller: 'BookController',
      title: 'Book configuration'
    });

  }]);

  /**
   * Defines the book controller for the configuration page.
   */
  function BookController($scope) {

  }

  app.controller('BookController', BookController);
  BookController.$inject = ['$scope'];

})(angular);
</code></pre>

<p>Create the partial file <strong>assets/be/views/config.html</strong> :</p>
<pre><code class="html">&lt;p&gt;Configuration template&lt;/p&gt;
</code></pre>

<p>And add <strong>BookApp.js</strong> to the list of scripts to load with the back end (<strong>in conf.json</strong>) :</p>
<pre><code class="json">{
  &quot;backOffice&quot;: {
    &quot;scriptFiles&quot; : {
      &quot;dev&quot; : [
        &quot;/book/be/js/BookApp.js&quot;
      ]
    }
  }
}
</code></pre>

<h2 id="translate-your-back-end-pages">Translate your back end pages</h2>
<p>You can translate your back end pages using the back end dictionary called <strong>admin-back-office</strong>. Core will search for an <strong>i18n</strong> directory to look for dictionaries.</p>
<p>Create an <strong>i18n</strong> directory with french and english dictionaries for the back end :</p>
<p><strong>i18n/admin-back-office-en.json</strong> :</p>
<pre><code class="json">{
  &quot;BOOK&quot; : {
    &quot;CONFIGURATION&quot; : &quot;Configuration template&quot;
  }
}
</code></pre>

<p><strong>i18n/admin-back-office-fr.json</strong> :</p>
<pre><code class="json">{
  &quot;BOOK&quot; : {
    &quot;CONFIGURATION&quot; : &quot;Template de configuration&quot;
  }
}
</code></pre>

<p>You can now translate your <strong>config.html</strong> file :</p>
<pre><code class="html">&lt;p&gt;{{'BOOK.CONFIGURATION' | translate}}&lt;/p&gt;
</code></pre>

<p><strong>Nb :</strong> For more information on internationalization please refer to the <a href="../../developers/i18n">i18n documentation</a>.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../compilation/" class="btn btn-neutral float-right" title="CSS / SASS / JS compilation"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../back-end/" class="btn btn-neutral" title="Back end AngularJS"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../back-end/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../compilation/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
